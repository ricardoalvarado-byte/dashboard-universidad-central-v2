<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Dashboard de Gesti√≥n de Procesos - Universidad Central">
    <title>Dashboard Universidad Central - Gesti√≥n de Procesos</title>
    <link rel="stylesheet" href="styles/globals.css">
    <link rel="stylesheet" href="styles/dashboard.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <h1 class="logo-title">Universidad Central</h1>
                <p class="logo-subtitle">Sistema de Gesti√≥n de Procesos</p>
            </div>
            <div class="header-actions">
                <button id="toggleViewBtn" class="btn-secondary">
                    <span class="icon">üë§</span>
                    Panel Administrativo
                </button>
            </div>
        </div>
    </header>

    <!-- Main Dashboard View -->
    <main id="dashboardView" class="dashboard-container">
        <!-- Top Filters -->
        <section class="top-filters glass-card">
            <h2 class="filter-title">Filtrar por Sistema</h2>
            <div class="filter-chips" id="sistemaFilters">
                <button class="chip active" data-sistema="all">Todos</button>
                <button class="chip" data-sistema="Rector√≠a">Rector√≠a</button>
                <button class="chip" data-sistema="Vicerrector√≠a Administrativa y Financiera">Vicerrector√≠a
                    Administrativa y Financiera</button>
                <button class="chip" data-sistema="Vicerrector√≠a Acad√©mica">Vicerrector√≠a Acad√©mica</button>
                <button class="chip" data-sistema="Vicerrector√≠a de Programas">Vicerrector√≠a de Programas</button>
            </div>
        </section>

        <div class="dashboard-layout">
            <!-- Left Sidebar - Subsistemas Filter -->
            <aside class="left-sidebar glass-card">
                <h3 class="sidebar-title">Filtros Adicionales</h3>

                <div class="filter-group">
                    <label class="filter-label">Subsistema</label>
                    <select id="subsistemaFilter" class="filter-select">
                        <option value="all">Todos los subsistemas</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label">√Årea L√≠der</label>
                    <input type="text" id="areaFilter" class="filter-input" placeholder="Buscar √°rea...">
                </div>

                <div class="filter-group">
                    <label class="filter-label">Gestor Funcional</label>
                    <input type="text" id="gestorFilter" class="filter-input" placeholder="Buscar gestor...">
                </div>

                <button id="clearFiltersBtn" class="btn-clear">Limpiar Filtros</button>

                <div class="filter-stats">
                    <p class="stats-text">Mostrando <strong id="filteredCount">0</strong> de <strong
                            id="totalCount">0</strong> procedimientos</p>
                </div>
            </aside>

            <!-- Center Content -->
            <div class="center-content">
                <!-- Charts Section -->
                <section class="charts-section">
                    <div class="chart-grid">
                        <!-- KPI Cards -->
                        <div class="kpi-card glass-card kpi-primary">
                            <div class="kpi-icon">üìä</div>
                            <div class="kpi-content">
                                <h3 class="kpi-label">Total Procedimientos</h3>
                                <p class="kpi-value" id="totalProcedimientosKpi">0</p>
                                <span class="kpi-trend">Filtrados</span>
                            </div>
                        </div>

                        <div class="kpi-card glass-card kpi-success">
                            <div class="kpi-icon">‚úÖ</div>
                            <div class="kpi-content">
                                <h3 class="kpi-label">Completitud Global</h3>
                                <p class="kpi-value" id="globalCompletionKpi">0%</p>
                                <span class="kpi-trend">Promedio ponderado</span>
                            </div>
                        </div>

                        <div class="kpi-card glass-card kpi-warning">
                            <div class="kpi-icon">‚è≥</div>
                            <div class="kpi-content">
                                <h3 class="kpi-label">En Gesti√≥n</h3>
                                <p class="kpi-value" id="inProcessKpi">0</p>
                                <span class="kpi-trend">Activos (No pendientes)</span>
                            </div>
                        </div>

                        <div class="kpi-card glass-card kpi-info">
                            <div class="kpi-icon">üèÜ</div>
                            <div class="kpi-content">
                                <h3 class="kpi-label">Mejor √Årea</h3>
                                <p class="kpi-value" id="topAreaKpi">-</p>
                                <span class="kpi-trend" id="topAreaValue">-</span>
                            </div>
                        </div>

                        <!-- Donut Chart -->
                        <div class="chart-card glass-card chart-large">
                            <h3 class="chart-title">Distribuci√≥n por Estado</h3>
                            <div class="chart-container">
                                <canvas id="donutChart"></canvas>
                            </div>
                        </div>

                        <!-- Bar Chart -->
                        <div class="chart-card glass-card chart-large">
                            <h3 class="chart-title">Avance por √Årea</h3>
                            <div class="chart-container large">
                                <canvas id="barChart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Conventions Panel -->
                <section class="conventions-panel glass-card">
                    <h3 class="section-title">Convenciones de Estados</h3>
                    <div class="conventions-grid" id="conventionsGrid">
                        <!-- Will be populated dynamically -->
                    </div>
                </section>

                <!-- Detailed Table -->
                <section class="table-section glass-card">
                    <div class="table-header">
                        <h3 class="section-title">Detalle de Procedimientos</h3>
                        <div class="table-actions">
                            <input type="text" id="tableSearch" class="search-input"
                                placeholder="üîç Buscar en tabla...">
                            <button id="exportExcelBtn" class="btn-primary">üì• Exportar Excel</button>
                            <button id="exportPdfBtn" class="btn-secondary">üìÑ Exportar PDF</button>
                        </div>
                    </div>
                    <div class="table-wrapper">
                        <table id="procedimientosTable" class="data-table">
                            <thead>
                                <tr>
                                    <th data-sort="nombre">Nombre del Procedimiento <span class="sort-icon">‚áÖ</span>
                                    </th>
                                    <th data-sort="sistema">Sistema <span class="sort-icon">‚áÖ</span></th>
                                    <th data-sort="subsistema">Subsistema <span class="sort-icon">‚áÖ</span></th>
                                    <th data-sort="areaLider">√Årea L√≠der <span class="sort-icon">‚áÖ</span></th>
                                    <th data-sort="gestorFuncional">Gestor Funcional <span class="sort-icon">‚áÖ</span>
                                    </th>
                                    <th data-sort="estado">Estado <span class="sort-icon">‚áÖ</span></th>
                                    <th data-sort="porcentaje">% Avance <span class="sort-icon">‚áÖ</span></th>
                                </tr>
                            </thead>
                            <tbody id="tableBody">
                                <!-- Will be populated dynamically -->
                            </tbody>
                        </table>
                    </div>
                    <div class="pagination" id="pagination">
                        <!-- Will be populated dynamically -->
                    </div>
                </section>
            </div>

            <!-- Right Sidebar - Estado Filter -->
            <aside class="right-sidebar glass-card">
                <h3 class="sidebar-title">Filtrar por Estado</h3>
                <div class="estado-filters" id="estadoFilters">
                    <!-- Will be populated dynamically -->
                </div>
            </aside>
        </div>
    </main>

    <!-- Admin Panel View (Hidden by default) -->
    <main id="adminView" class="admin-container" style="display: none;">
        <div class="admin-content">
            <!-- Login Form -->
            <div id="loginForm" class="login-container">
                <div class="login-card glass-card">
                    <h2 class="login-title">Panel Administrativo</h2>
                    <p class="login-subtitle">Universidad Central</p>
                    <form id="loginFormElement">
                        <div class="form-group">
                            <label for="username" class="form-label">Usuario</label>
                            <input type="text" id="username" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label for="password" class="form-label">Contrase√±a</label>
                            <input type="password" id="password" class="form-input" required>
                        </div>
                        <button type="submit" class="btn-primary btn-full">Iniciar Sesi√≥n</button>
                        <div id="loginError" class="error-message" style="display: none;"></div>
                    </form>
                    <button id="backToDashboardBtn" class="btn-link">‚Üê Volver al Dashboard</button>
                </div>
            </div>

            <!-- Admin Dashboard (Hidden until login) -->
            <div id="adminDashboard" style="display: none;">
                <div class="admin-header">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <h2 class="admin-title">Panel de Administraci√≥n</h2>
                        <button id="viewDashboardBtn" class="btn-secondary"
                            style="background: rgba(16, 185, 129, 0.1); border-color: rgba(16, 185, 129, 0.3); color: #10b981;">
                            <span class="icon">üëÅÔ∏è</span> Ver Vista de Usuario
                        </button>
                    </div>
                    <div id="vIndicator"
                        style="background: #ef4444; color: white; padding: 2px 10px; border-radius: 4px; font-size: 12px; font-weight: bold;">
                        VERSION 1.1.3 - SUPABASE</div>
                    <button id="logoutBtn" class="btn-secondary">Cerrar Sesi√≥n</button>
                </div>

                <div class="admin-tabs">
                    <button class="tab-btn active" data-tab="import">Importar Datos</button>
                    <button class="tab-btn" data-tab="manage">Gestionar Procedimientos</button>
                    <button class="tab-btn" data-tab="config">Configuraci√≥n</button>
                </div>

                <!-- Import Tab -->
                <div id="importTab" class="tab-content active">
                    <div class="import-header">
                        <div class="import-header-content">
                            <div>
                                <h3 class="import-main-title">Gesti√≥n de Datos por Sistema</h3>
                                <p class="import-subtitle">Carga o elimina datos de forma independiente para cada
                                    sistema</p>
                            </div>
                            <div class="admin-header-actions" style="display: flex; gap: 1rem; align-items: center;">
                                <button id="saveAllDataBtn" class="btn-primary"
                                    style="background-color: var(--uc-green-light); color: var(--bg-dark); font-weight: 800; padding: 0.75rem 1.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.2);">
                                    <span class="icon">üíæ</span>
                                    Guardar Cambios en la Nube
                                </button>
                                <button id="deleteAllDataBtn" class="btn-danger">
                                    <span class="icon">üóëÔ∏è</span>
                                    Borrar Todos los Datos
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="import-systems-grid">
                        <!-- Rector√≠a -->
                        <div class="glass-card system-upload-card">
                            <div class="system-card-header">
                                <h3 class="system-upload-title">üìã Rector√≠a</h3>
                                <div class="system-actions">
                                    <span class="system-count" data-sistema="Rector√≠a">0 procedimientos</span>
                                    <button class="btn-delete-system" data-sistema="Rector√≠a"
                                        title="Borrar datos de Rector√≠a">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            </div>
                            <div class="upload-area" data-sistema="Rector√≠a">
                                <div class="upload-icon">üìÅ</div>
                                <p class="upload-text">Arrastra archivo Excel de Rector√≠a</p>
                                <p class="upload-hint">.xlsx, .xls, .csv</p>
                                <input type="file" class="file-input" accept=".xlsx,.xls,.csv" style="display: none;">
                            </div>
                            <div class="file-preview" style="display: none;">
                                <h4>Vista Previa</h4>
                                <div class="preview-table"></div>
                                <div class="button-group">
                                    <button class="confirm-import-btn btn-primary">Confirmar</button>
                                    <button class="cancel-import-btn btn-secondary">Cancelar</button>
                                </div>
                            </div>
                        </div>

                        <!-- Vicerrector√≠a Administrativa y Financiera -->
                        <div class="glass-card system-upload-card">
                            <div class="system-card-header">
                                <h3 class="system-upload-title">üíº Vicerrector√≠a Administrativa y Financiera</h3>
                                <div class="system-actions">
                                    <span class="system-count"
                                        data-sistema="Vicerrector√≠a Administrativa y Financiera">0 procedimientos</span>
                                    <button class="btn-delete-system"
                                        data-sistema="Vicerrector√≠a Administrativa y Financiera"
                                        title="Borrar datos de V. Administrativa">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            </div>
                            <div class="upload-area" data-sistema="Vicerrector√≠a Administrativa y Financiera">
                                <div class="upload-icon">üìÅ</div>
                                <p class="upload-text">Arrastra archivo Excel de V. Administrativa</p>
                                <p class="upload-hint">.xlsx, .xls, .csv</p>
                                <input type="file" class="file-input" accept=".xlsx,.xls,.csv" style="display: none;">
                            </div>
                            <div class="file-preview" style="display: none;">
                                <h4>Vista Previa</h4>
                                <div class="preview-table"></div>
                                <div class="button-group">
                                    <button class="confirm-import-btn btn-primary">Confirmar</button>
                                    <button class="cancel-import-btn btn-secondary">Cancelar</button>
                                </div>
                            </div>
                        </div>

                        <!-- Vicerrector√≠a Acad√©mica -->
                        <div class="glass-card system-upload-card">
                            <div class="system-card-header">
                                <h3 class="system-upload-title">üéì Vicerrector√≠a Acad√©mica</h3>
                                <div class="system-actions">
                                    <span class="system-count" data-sistema="Vicerrector√≠a Acad√©mica">0
                                        procedimientos</span>
                                    <button class="btn-delete-system" data-sistema="Vicerrector√≠a Acad√©mica"
                                        title="Borrar datos de V. Acad√©mica">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            </div>
                            <div class="upload-area" data-sistema="Vicerrector√≠a Acad√©mica">
                                <div class="upload-icon">üìÅ</div>
                                <p class="upload-text">Arrastra archivo Excel de V. Acad√©mica</p>
                                <p class="upload-hint">.xlsx, .xls, .csv</p>
                                <input type="file" class="file-input" accept=".xlsx,.xls,.csv" style="display: none;">
                            </div>
                            <div class="file-preview" style="display: none;">
                                <h4>Vista Previa</h4>
                                <div class="preview-table"></div>
                                <div class="button-group">
                                    <button class="confirm-import-btn btn-primary">Confirmar</button>
                                    <button class="cancel-import-btn btn-secondary">Cancelar</button>
                                </div>
                            </div>
                        </div>

                        <!-- Vicerrector√≠a de Programas -->
                        <div class="glass-card system-upload-card">
                            <div class="system-card-header">
                                <h3 class="system-upload-title">üöÄ Vicerrector√≠a de Programas</h3>
                                <div class="system-actions">
                                    <span class="system-count" data-sistema="Vicerrector√≠a de Programas">0
                                        procedimientos</span>
                                    <button class="btn-delete-system" data-sistema="Vicerrector√≠a de Programas"
                                        title="Borrar datos de V. Programas">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            </div>
                            <div class="upload-area" data-sistema="Vicerrector√≠a de Programas">
                                <div class="upload-icon">üìÅ</div>
                                <p class="upload-text">Arrastra archivo Excel de V. Programas</p>
                                <p class="upload-hint">.xlsx, .xls, .csv</p>
                                <input type="file" class="file-input" accept=".xlsx,.xls,.csv" style="display: none;">
                            </div>
                            <div class="file-preview" style="display: none;">
                                <h4>Vista Previa</h4>
                                <div class="preview-table"></div>
                                <div class="button-group">
                                    <button class="confirm-import-btn btn-primary">Confirmar</button>
                                    <button class="cancel-import-btn btn-secondary">Cancelar</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Manage Tab -->
                <div id="manageTab" class="tab-content">
                    <div class="glass-card">
                        <h3 class="section-title">Gesti√≥n de Procedimientos</h3>
                        <button id="addProcedimientoBtn" class="btn-primary">+ Agregar Procedimiento</button>
                        <div id="adminTableContainer"></div>
                    </div>
                </div>

                <!-- Config Tab -->
                <div id="configTab" class="tab-content">
                    <div class="glass-card">
                        <h3 class="section-title">Personalizaci√≥n de Columnas</h3>
                        <p style="margin-bottom: var(--spacing-lg); color: var(--text-secondary);">
                            Elige qu√© columnas mostrar en la tabla y personaliza sus nombres seg√∫n tu Excel.
                        </p>
                        <div id="columnsConfig" style="margin-bottom: var(--spacing-2xl);"></div>

                        <div style="border-top: 1px solid var(--glass-border); margin: var(--spacing-xl) 0;"></div>

                        <h3 class="section-title">Configuraci√≥n de Estados</h3>
                        <div id="estadosConfig"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="js/supabase-config.js?v=1.1.0"></script>
    <script src="js/data.js?v=1.1.0"></script>
    <script src="js/charts.js?v=1.1.0"></script>
    <script src="js/filters.js?v=1.1.0"></script>
    <script src="js/table.js?v=1.1.0"></script>
    <script src="js/admin.js?v=1.1.0"></script>
    <script src="js/app.js?v=1.1.0"></script>
</body>

</html>